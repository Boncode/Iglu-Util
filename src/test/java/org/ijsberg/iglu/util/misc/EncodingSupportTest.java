/*
 * Copyright 2011-2013 Jeroen Meetsma - IJsberg
 *
 * This file is part of Iglu.
 *
 * Iglu is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Iglu is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with Iglu.  If not, see <http://www.gnu.org/licenses/>.
 */

package org.ijsberg.iglu.util.misc;


import org.junit.Assert;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.nio.charset.StandardCharsets;
import java.security.*;
import java.security.cert.CertificateException;
import java.security.cert.CertificateFactory;
import java.security.cert.X509Certificate;
import java.util.Random;

public class EncodingSupportTest {

    @Test
    public void encodeXor() {
    }

    @Test
    public void testDeflateInflate() throws Exception {
        String samlRequest = "<samlp:AuthnRequest\n" +
                "\txmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"\n" +
                "\txmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\"\n" +
                "\tID=\"ID_12345\"" +
                "\tVersion=\"2.0\"\n" +
                "\tIssueInstant=\"2004-12-05T09:21:59Z\"\n" +
                "\tAssertionConsumerServiceIndex=\"0\"\n" +
                "\tAttributeConsumingServiceIndex=\"0\">\n" +
                "\t<saml:Issuer>https://sp.example.com/SAML2</saml:Issuer>\n" +
                "\t<samlp:NameIDPolicy  AllowCreate=\"true\"  Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\"/>\n" +
                "</samlp:AuthnRequest>";

        byte[] samlRequestBytes = samlRequest.getBytes(StandardCharsets.UTF_8);
        byte[] deflatedBytes = EncodingSupport.deflate(samlRequestBytes);
        byte[] inflatedBytes = EncodingSupport.inflate(deflatedBytes);

        String samlRequestDeflatedInflated = new String(inflatedBytes, StandardCharsets.UTF_8);

        Assert.assertEquals(samlRequest, samlRequestDeflatedInflated);
    }

    @Test
    public void testDeflateInflateBigString() throws Exception {
        byte[] randomByteArray = new byte[10000];
        Random random = new Random();
        random.nextBytes(randomByteArray);
        String generatedString = new String(randomByteArray, StandardCharsets.UTF_8);

        byte[] deflatedBytes = EncodingSupport.deflate(generatedString.getBytes(StandardCharsets.UTF_8));
        byte[] inflatedBytes = EncodingSupport.inflate(deflatedBytes);

        Assert.assertEquals(generatedString, new String(inflatedBytes, StandardCharsets.UTF_8));
    }

    //MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==

    @Test
    public void test() throws CertificateException, NoSuchAlgorithmException, InvalidKeyException, SignatureException {
        CertificateFactory fact = CertificateFactory.getInstance("X.509");
        String certFromMetaData = "MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==";
//        String certInSignature = "MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==";
        X509Certificate cer = (X509Certificate) fact.generateCertificate(new ByteArrayInputStream(EncodingSupport.decodeBase64(certFromMetaData)));
        PublicKey key = cer.getPublicKey();

        final Signature sig = Signature.getInstance("SHA256withRSA");
        sig.initVerify(key);

        //todo try assertion received
//        String samlResponse = "<samlp:Response ID=\"_42983b94-0215-45d8-9cd4-b66b99d4dd51\" Version=\"2.0\" IssueInstant=\"2023-12-07T17:02:54.082Z\" Destination=\"http://localhost:17684/user/entra/auth\" InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"><Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><Assertion ID=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\" IssueInstant=\"2023-12-07T17:02:54.079Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>rrQzFVUrmVbw5AULRej6m067bDqUD/TFMcGtZBfL2Z0=</DigestValue></Reference></SignedInfo><SignatureValue>Prlc9kOFC+EBLBT79uXOdfwYEaFNSatU0f9cxQ9NJIjaChMJQfDSS0lQSX5r7EBbii1QCF6rT9aA/Y3o91OSCUVisbUVmVI1565Hhsx/GdQSKY/hFnQVB0aKuPCtTfX9Vo7tzR7ecz/C1NcDFkTSlRN65BSq/zTy7r+ifVoTLYKn1tvSNJPUmgZLRKMg+Q0bYLC9Ycrokcih4vNq5GBSBvAEOCrmOWRUFx/mg3WPq8Ya/St6OSAUBMOmCb6SAp+MzZnIH/eqNxmXE+6QEGiVn4dbW1NrCzF5E7WQu7py/osdUzZ3cuYO4aEh3VdBD7VarfQ2T9a29qXZLKq2v2uz5w==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==</X509Certificate></X509Data></KeyInfo></Signature><Subject><NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">sSPqzoOrCNH/6GnMbF90jEb98FeZ1V5+pXEIjErY1Jo=</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><SubjectConfirmationData InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\" Recipient=\"http://localhost:17684/user/entra/auth\"/></SubjectConfirmation></Subject><Conditions NotBefore=\"2023-12-07T16:57:54.030Z\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\"><AudienceRestriction><Audience>api://4171cebd-384e-45d0-8324-eda37d86586d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>98fa3760-c220-4721-b59a-351adb59525b</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/objectidentifier\"><AttributeValue>4ca43cbf-ef99-4746-96c7-8e9d94b277f8</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>k.naarding@boncode.nl</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Koen</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/displayname\"><AttributeValue>Koen Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/claims/multipleauthn</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2023-10-09T13:13:25.073Z\" SessionIndex=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>";
        String samlResponseAssertionOnly = "<samlp:Response ID=\"_42983b94-0215-45d8-9cd4-b66b99d4dd51\" Version=\"2.0\" IssueInstant=\"2023-12-07T17:02:54.082Z\" Destination=\"http://localhost:17684/user/entra/auth\" InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"><Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><Assertion ID=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\" IssueInstant=\"2023-12-07T17:02:54.079Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"/><Reference URI=\"#_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"/><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"/></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"/><DigestValue>rrQzFVUrmVbw5AULRej6m067bDqUD/TFMcGtZBfL2Z0=</DigestValue></Reference></SignedInfo><SignatureValue>Prlc9kOFC+EBLBT79uXOdfwYEaFNSatU0f9cxQ9NJIjaChMJQfDSS0lQSX5r7EBbii1QCF6rT9aA/Y3o91OSCUVisbUVmVI1565Hhsx/GdQSKY/hFnQVB0aKuPCtTfX9Vo7tzR7ecz/C1NcDFkTSlRN65BSq/zTy7r+ifVoTLYKn1tvSNJPUmgZLRKMg+Q0bYLC9Ycrokcih4vNq5GBSBvAEOCrmOWRUFx/mg3WPq8Ya/St6OSAUBMOmCb6SAp+MzZnIH/eqNxmXE+6QEGiVn4dbW1NrCzF5E7WQu7py/osdUzZ3cuYO4aEh3VdBD7VarfQ2T9a29qXZLKq2v2uz5w==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==</X509Certificate></X509Data></KeyInfo></Signature><Subject><NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">sSPqzoOrCNH/6GnMbF90jEb98FeZ1V5+pXEIjErY1Jo=</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><SubjectConfirmationData InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\" Recipient=\"http://localhost:17684/user/entra/auth\"/></SubjectConfirmation></Subject><Conditions NotBefore=\"2023-12-07T16:57:54.030Z\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\"><AudienceRestriction><Audience>api://4171cebd-384e-45d0-8324-eda37d86586d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>98fa3760-c220-4721-b59a-351adb59525b</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/objectidentifier\"><AttributeValue>4ca43cbf-ef99-4746-96c7-8e9d94b277f8</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>k.naarding@boncode.nl</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Koen</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/displayname\"><AttributeValue>Koen Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/claims/multipleauthn</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2023-10-09T13:13:25.073Z\" SessionIndex=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>";
//        String samlResponseC14N = "<samlp:Response xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\" Destination=\"http://localhost:17684/user/entra/auth\" ID=\"_42983b94-0215-45d8-9cd4-b66b99d4dd51\" InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" IssueInstant=\"2023-12-07T17:02:54.082Z\" Version=\"2.0\"><Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"></samlp:StatusCode></samlp:Status><Assertion xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\" IssueInstant=\"2023-12-07T17:02:54.079Z\" Version=\"2.0\"><Issuer>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"><SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></CanonicalizationMethod><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"></SignatureMethod><Reference URI=\"#_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"></Transform><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></Transform></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"></DigestMethod><DigestValue>rrQzFVUrmVbw5AULRej6m067bDqUD/TFMcGtZBfL2Z0=</DigestValue></Reference></SignedInfo><SignatureValue>Prlc9kOFC+EBLBT79uXOdfwYEaFNSatU0f9cxQ9NJIjaChMJQfDSS0lQSX5r7EBbii1QCF6rT9aA/Y3o91OSCUVisbUVmVI1565Hhsx/GdQSKY/hFnQVB0aKuPCtTfX9Vo7tzR7ecz/C1NcDFkTSlRN65BSq/zTy7r+ifVoTLYKn1tvSNJPUmgZLRKMg+Q0bYLC9Ycrokcih4vNq5GBSBvAEOCrmOWRUFx/mg3WPq8Ya/St6OSAUBMOmCb6SAp+MzZnIH/eqNxmXE+6QEGiVn4dbW1NrCzF5E7WQu7py/osdUzZ3cuYO4aEh3VdBD7VarfQ2T9a29qXZLKq2v2uz5w==</SignatureValue><KeyInfo><X509Data><X509Certificate>MIIC/TCCAeWgAwIBAgIIUd7j/OIahkYwDQYJKoZIhvcNAQELBQAwLTErMCkGA1UEAxMiYWNjb3VudHMuYWNjZXNzY29udHJvbC53aW5kb3dzLm5ldDAeFw0yMzExMDExNjAzMjdaFw0yODExMDExNjAzMjdaMC0xKzApBgNVBAMTImFjY291bnRzLmFjY2Vzc2NvbnRyb2wud2luZG93cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzZMJFMHQcoR8sE+Lf/wLEJtaKvPuuW/Nxeen/SPeOuZv+Gy3SKIeJ9IHATQVXVZbv0rLDQABOQt9IsvKWXIK7OChQ6CZd3dgxqoHyZA4Eh5wVAMAeQzWzLOL9XBV0m3wfXIjSE4Zw6S26MM8eJ1UW066gOoBaUKzuQIbCVrMrhJ+7+md8kjhGZTwC+o7Rq4ZzGDbggJuk/TUbQ+Bu9by6FZJZJJNeZ90iHnrsk4eyC8WvSbUBRC/vBt5HGDKIfCfb2HqDVvBJgkHgjpMwb5wPKC9T2U1YXN5iG2obhn9wDeSFYgyZOrd1XMKyLiJTfT35zQWilZpxMei4fIxFykkVAgMBAAGjITAfMB0GA1UdDgQWBBRNcCE3HDX+HOJOu/bKfLYoSX3/0jANBgkqhkiG9w0BAQsFAAOCAQEAExns169MDr1dDNELYNK0JDjPUA6GR50jqfc+xa2KOljeXErOdihSvKgDS/vnDN6fjNNZuOMDyr6jjLvRsT0jVWzf/B6v92FrPRa/rv3urGXvW5am3BZyVPipirbiolMTuork95G7y7imftK7117uHcMq3D8f4fxscDiDXgjEEZqjkuzYDGLaVWGJqpv5xE4w+K4o2uDwmEIeIX+rI1MEVucS2vsvraOrjqjHwc3KrzuVRSsOU7YVHyUhku+7oOrB4tYrVbYYgwd6zXnkdouVPqOX9wTkc9iTmbDP+rfkhdadLxU+hmMyMuCJKgkZbWKFES7ce23jfTMbpqoHB4pgtQ==</X509Certificate></X509Data></KeyInfo></Signature><Subject><NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">sSPqzoOrCNH/6GnMbF90jEb98FeZ1V5+pXEIjErY1Jo=</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><SubjectConfirmationData InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\" Recipient=\"http://localhost:17684/user/entra/auth\"></SubjectConfirmationData></SubjectConfirmation></Subject><Conditions NotBefore=\"2023-12-07T16:57:54.030Z\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\"><AudienceRestriction><Audience>api://4171cebd-384e-45d0-8324-eda37d86586d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>98fa3760-c220-4721-b59a-351adb59525b</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/objectidentifier\"><AttributeValue>4ca43cbf-ef99-4746-96c7-8e9d94b277f8</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>k.naarding@boncode.nl</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Koen</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/displayname\"><AttributeValue>Koen Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/claims/multipleauthn</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2023-10-09T13:13:25.073Z\" SessionIndex=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>";
//        String samlResponseC14NOnlySignedInfo = "<SignedInfo><CanonicalizationMethod Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></CanonicalizationMethod><SignatureMethod Algorithm=\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"></SignatureMethod><Reference URI=\"#_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><Transforms><Transform Algorithm=\"http://www.w3.org/2000/09/xmldsig#enveloped-signature\"></Transform><Transform Algorithm=\"http://www.w3.org/2001/10/xml-exc-c14n#\"></Transform></Transforms><DigestMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#sha256\"></DigestMethod><DigestValue>rrQzFVUrmVbw5AULRej6m067bDqUD/TFMcGtZBfL2Z0=</DigestValue></Reference></SignedInfo>";
        String samlResponseC14NNoSignatureAssertionOnly = "<Assertion xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\" ID=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\" IssueInstant=\"2023-12-07T17:02:54.079Z\" Version=\"2.0\"><Issuer>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><Subject><NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">sSPqzoOrCNH/6GnMbF90jEb98FeZ1V5+pXEIjErY1Jo=</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><SubjectConfirmationData InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\" Recipient=\"http://localhost:17684/user/entra/auth\"></SubjectConfirmationData></SubjectConfirmation></Subject><Conditions NotBefore=\"2023-12-07T16:57:54.030Z\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\"><AudienceRestriction><Audience>api://4171cebd-384e-45d0-8324-eda37d86586d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>98fa3760-c220-4721-b59a-351adb59525b</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/objectidentifier\"><AttributeValue>4ca43cbf-ef99-4746-96c7-8e9d94b277f8</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>k.naarding@boncode.nl</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Koen</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/displayname\"><AttributeValue>Koen Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/claims/multipleauthn</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2023-10-09T13:13:25.073Z\" SessionIndex=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion>";
//        String samlResponseNoSignature = "<samlp:Response ID=\"_42983b94-0215-45d8-9cd4-b66b99d4dd51\" Version=\"2.0\" IssueInstant=\"2023-12-07T17:02:54.082Z\" Destination=\"http://localhost:17684/user/entra/auth\" InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"><Issuer xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><samlp:Status><samlp:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></samlp:Status><Assertion ID=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\" IssueInstant=\"2023-12-07T17:02:54.079Z\" Version=\"2.0\" xmlns=\"urn:oasis:names:tc:SAML:2.0:assertion\"><Issuer>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</Issuer><Subject><NameID Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\">sSPqzoOrCNH/6GnMbF90jEb98FeZ1V5+pXEIjErY1Jo=</NameID><SubjectConfirmation Method=\"urn:oasis:names:tc:SAML:2.0:cm:bearer\"><SubjectConfirmationData InResponseTo=\"ID_1d579047-4d76-4cd7-9271-7d5dfc2c9ea1\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\" Recipient=\"http://localhost:17684/user/entra/auth\"/></SubjectConfirmation></Subject><Conditions NotBefore=\"2023-12-07T16:57:54.030Z\" NotOnOrAfter=\"2023-12-07T18:02:54.030Z\"><AudienceRestriction><Audience>api://4171cebd-384e-45d0-8324-eda37d86586d</Audience></AudienceRestriction></Conditions><AttributeStatement><Attribute Name=\"http://schemas.microsoft.com/identity/claims/tenantid\"><AttributeValue>98fa3760-c220-4721-b59a-351adb59525b</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/objectidentifier\"><AttributeValue>4ca43cbf-ef99-4746-96c7-8e9d94b277f8</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name\"><AttributeValue>k.naarding@boncode.nl</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname\"><AttributeValue>Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname\"><AttributeValue>Koen</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/displayname\"><AttributeValue>Koen Naarding</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/identity/claims/identityprovider\"><AttributeValue>https://sts.windows.net/98fa3760-c220-4721-b59a-351adb59525b/</AttributeValue></Attribute><Attribute Name=\"http://schemas.microsoft.com/claims/authnmethodsreferences\"><AttributeValue>http://schemas.microsoft.com/ws/2008/06/identity/authenticationmethod/password</AttributeValue><AttributeValue>http://schemas.microsoft.com/claims/multipleauthn</AttributeValue></Attribute></AttributeStatement><AuthnStatement AuthnInstant=\"2023-10-09T13:13:25.073Z\" SessionIndex=\"_eb3dabed-47a0-43e4-bab0-55be58aa7100\"><AuthnContext><AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:Password</AuthnContextClassRef></AuthnContext></AuthnStatement></Assertion></samlp:Response>";

//        sig.update(samlResponseNoSignature.getBytes(StandardCharsets.UTF_8));
        sig.update(samlResponseC14NNoSignatureAssertionOnly.getBytes(StandardCharsets.UTF_8));

//        String signatureString = "lgICO4MlLnTh3PpHUtGoIhg58ubwHCSTQaxqPB5zlVcagLAJjPo528bZlq5AlAgsaxALUomL/sXIvpPwF25UKyiCVhLjbfRjERc0Pwv4AyGSwmJoNWC9Hc2A+Z5gtqX+xqamGk9rEaDSDTKXI1CYKXZBy+XzeeMb+zF08Vw12nUjdqHf2AXnQHnSkebH3kkRfljZeVK9NRfCnWZwrl6fZ6TAlu3JKuiwsXCBjRDOoyOE5P4F5CvbWfA17EWt+jIhLsTxVFM01GuGDDMiVehe02l+uLvTFYwhv201CI5FswhRnkv8u4Q54CXYXt2Y0aaOxhjwC2ijKIkLONb2pLrJZA==";
        String signatureString = "Prlc9kOFC+EBLBT79uXOdfwYEaFNSatU0f9cxQ9NJIjaChMJQfDSS0lQSX5r7EBbii1QCF6rT9aA/Y3o91OSCUVisbUVmVI1565Hhsx/GdQSKY/hFnQVB0aKuPCtTfX9Vo7tzR7ecz/C1NcDFkTSlRN65BSq/zTy7r+ifVoTLYKn1tvSNJPUmgZLRKMg+Q0bYLC9Ycrokcih4vNq5GBSBvAEOCrmOWRUFx/mg3WPq8Ya/St6OSAUBMOmCb6SAp+MzZnIH/eqNxmXE+6QEGiVn4dbW1NrCzF5E7WQu7py/osdUzZ3cuYO4aEh3VdBD7VarfQ2T9a29qXZLKq2v2uz5w==";
        byte[] decodedSig = EncodingSupport.decodeBase64(signatureString);
        System.out.println(sig.verify(decodedSig));
        byte[] actualDigestValue = EncodingSupport.decodeBase64("rrQzFVUrmVbw5AULRej6m067bDqUD/TFMcGtZBfL2Z0=");
        byte[] digestOfSignature = new byte[]{30, 80, -72, -113, -86, -32, -117, 127, 39, -34, -105, -49, 18, 12, 40, 127, -12, 87, 34, 102, -107, 44, 49, 96, -91, -47, 118, 56, -124, 14, -117, 90};
        String bla = ";";
    }

}

